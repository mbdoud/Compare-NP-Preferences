=============================================================================
Analysis of Amino-Acid Preferences in Two Homologs of Influenza Nucleoprotein
=============================================================================

.. contents::
  :depth: 2

Summary
-------

These scripts perform a comparative analysis of site-specific amino-acid preferences inferred from deep mutational scanning data for two homologs of influenza nucleoprotein (NP). First, `mapmuts`_, a package for analyzing deep-sequencing data to identify mutation frequencies in mutant libraries of a gene, is used to process Illumina sequencing data (`SRA Accession #SRP056028`_) for biological replicate mutant libraries of PR/1934(H1N1) and Aichi/1968(H3N2) NP. Next, `dms_tools`_, a package for analyzing deep mutational scanning data, is used to infer site-specific amino-acid preferences for each replicate mutant library. To quantify the extent that amino-acid preferences differ between NP homologs, ``compare_preferences.py`` calculates distance-based statistics that account for experimental noise by describing how different the amino-acid preferences are at each site *between* homologs relative to the experimental noise in amino-acid preferences across replicate experiments *within* each homolog. Finally, `phyloExpCM`_ is used to compare the performance of various codon substituion models based on the amino-acid preferences measured in each homolog to describe sequence evolution within human, swine, avian, and equine influenza NP phylogenetic trees. These scripts were written by Mike Doud and Orr Ashenberg and extensively use `mapmuts`_, `dms_tools`_, and `phyloExpCM`_, which were written by Jesse Bloom.

Running the analysis scripts
----------------------------

The entire analysis can be completed by sequentially running five master scripts: ``run_mapmuts.py``, ``run_dmstools.py``, ``make_correlation_plots.py``, ``compare_preferences.py``, and ``run_phyloanalysis.py``. Each of these master scripts are run at the command line with one argument, the name of a configuration file, which specifies paths to various directories that are used by that script (eg. ``python run_mapmuts.py mapmuts_config_file.txt``). Within each configuration file, each line must contain a directory name and the corresponding path, separated by a space (eg. ``FASTQ_directory /home/user/NP_homologs/FASTQ_files`` )

Running `mapmuts`_
~~~~~~~~~~~~~~~~~~~~

The configuration file for ``run_mapmuts.py`` must contain the following entries:

  * ``adapter_dir`` specifies the directory containing adapter sequences used for trimming during sequence alignment (``R1_adapter_AR0XX.fa``).
  * ``refseq_dir`` specifies the directory containing the reference sequences used for alignment (``PR8_NP.fa`` and ``Aichi68-NP_amplicon.fa``).
  * ``FASTQ_directory`` specifies the directory containing subdirectories storing the FASTQ files. These subdirectories are structured as: ``FASTQ_directory/(replicate)/(amplicon)/sequences.fastq``, with possible replicates including ``PR8_replicate_1``, ``PR8_replicate_2``, ``PR8_replicate_3``, ``Aichi68C_replicate_1``, and ``Aichi68C_replicate_2``, and possible amplicons including ``DNA``, ``virus``, ``mutDNA``, and ``mutvirus``.
  * ``mapmuts_output_dir`` specifies a directory in which the alignments and mutation parsing done by `mapmuts`_ will be saved. This directory is created if it doesn't already exist, and any files in this directory may be overwritten.

Running `dms_tools`_
~~~~~~~~~~~~~~~~~~~~

The configuration file for ``run_dmstools.py`` must contain the following entries:

 * ``mapmuts_output_dir`` must be the same directory specified to ``run_mapmuts.py``.
 * ``dmstools_output_dir`` specifies a directory in which the inferred amino-acid preferences are saved. This directory is created if it doesn't already exist, and any files in this directory may be overwritten.
 * ``previous_aichi_analysis_dir`` specifies a directory containing `previously published`_ `mapmuts`_ analysis for Aichi/1968 NP (analysis directory available `here`_).
 * ``previous_ha_analysis_dir`` specifies a directory containing the `published`_ `mapmuts`_ analysis for `WSN-HA`_.

Running ``make_correlation_plots.py``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The configuration file for ``make_correlation_plots.py`` must contain the following entries:

 * ``heatmap_script_path`` specifies the path to the ``correlation_heatmap.py`` script.
 * ``preferencefiles_dir`` specifies the path to the amino-acid preference files generated by `dms_tools`_, and should be the same directory specified as ``dmstools_output_dir`` to ``run_dmstools.py``.
 * ``plot_output_dir`` specifies a directory in which to save various correlation plots. This directory is created if it doesn't already exist, and any files in this directory may be overwritten.

Running ``compare_preferences.py``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The configuration file for ``compare_preferences.py`` must contain the following entries:

 * ``preferencefiles_dir`` specifies the path to the amino-acid preference files generated by `dms_tools`_, and should be the same directory specified as ``dmstools_output_dir`` to ``run_dmstools.py``.
 * ``calculate_rmsd_script_path`` specifies the path to the ``calculate_rmsd.py`` script.
 * ``output_directory`` specifies a directory in which to save the amino-acid preference RMSD analyses. This directory is created if it doesn't already exist, and any files in this directory may be overwritten.

Running ``run_phyloanalysis.py``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The configuration file for ``run_phyloanalysis.py`` must contain the following entry:

 * ``basedir`` specifies the path to the base directory for this analysis. This directory should contain the ``dmstools_output_dir`` where preference files are saved and the ``/phylo_input`` directory containing phylogenetic tree files.

Description of the analysis and results
---------------------------------------

Making alignments
~~~~~~~~~~~~~~~~~

Parsing mutations
~~~~~~~~~~~~~~~~~

Inferring site-specific amino-acid preferences
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Calculating and visualizing correlations in amino-acid preferences
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Quantifying differences in preferences between two groups of replicate experiments
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Generating null models of differences in the measured amino-acid preferences
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Analyzing differences in preferences within sites of functional, structural, and evolutionary importance
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Using amino-acid preferences to build codon substitution models
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Analyzing performance of amino-acid preference-based substitution models
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~





.. _`mapmuts`: https://github.com/jbloom/mapmuts
.. _`dms_tools`: https://github.com/jbloom/dms_tools
.. _`Python`: http://www.python.org/
.. _`phyloExpCM`: https://github.com/jbloom/phyloExpCM
.. _`previously published`: http://dx.doi.org/10.1093/molbev/msu173
.. _`here`: https://github.com/jbloom/mapmuts/tree/master/examples/2013Analysis_Influenza_NP_Aichi68
.. _`WSN-HA`: https://github.com/jbloom/mapmuts/tree/master/examples/WSN_HA_2014Analysis
.. _`published`: http://dx.doi.org/10.7554/eLife.03300
.. _`SRA Accession #SRP056028`: http://www.ncbi.nlm.nih.gov/sra/?term=SRP056028[Accession]
